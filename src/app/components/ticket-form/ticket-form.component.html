<div class="component-container ticket-form-container">
  <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
    <h2 class="section-heading">Event Details</h2>
    <div class="form-row">
      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Concert ID</mat-label>
        <input
          matInput
          type="number"
          id="concertId"
          formControlName="concertId"
          required
          min="1"
        />
        <mat-error *ngIf="ticketForm.get('concertId')?.hasError('required')">
          Concert ID is required
        </mat-error>
        <mat-error *ngIf="ticketForm.get('concertId')?.hasError('min')">
          Concert ID must be greater than 0
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Number of Tickets</mat-label>
        <mat-select id="quantity" formControlName="quantity" required>
          <mat-option
            *ngFor="let quantity of ticketQuantityOptions"
            [value]="quantity"
          >
            {{ quantity }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="ticketForm.get('quantity')?.hasError('required')">
          Please select the number of tickets
        </mat-error>
      </mat-form-field>
    </div>

    <h2 class="section-heading">Contact Information</h2>
    <mat-form-field appearance="fill">
      <mat-label>Full Name</mat-label>
      <input
        matInput
        type="text"
        id="name"
        formControlName="name"
        required
        maxlength="100"
      />
      <mat-error *ngIf="ticketForm.get('name')?.hasError('required')">
        Name is required
      </mat-error>
      <mat-error *ngIf="ticketForm.get('name')?.hasError('maxlength')">
        Name must not exceed 100 characters
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Email Address</mat-label>
      <input
        matInput
        type="email"
        id="email"
        formControlName="email"
        required
      />
      <mat-error *ngIf="ticketForm.get('email')?.hasError('required')">
        Email is required
      </mat-error>
      <mat-error *ngIf="ticketForm.get('email')?.hasError('email')">
        Please enter a valid email address
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Phone Number</mat-label>
      <input matInput type="tel" id="phone" formControlName="phone" required />
      <mat-error *ngIf="ticketForm.get('phone')?.hasError('required')">
        Phone is required
      </mat-error>
      <mat-error *ngIf="ticketForm.get('phone')?.hasError('pattern')">
        Invalid phone number format
      </mat-error>
    </mat-form-field>

    <h2 class="section-heading">Payment Information</h2>
    <mat-form-field appearance="fill">
      <mat-label>Credit Card Number</mat-label>
      <input
        matInput
        type="text"
        id="creditCard"
        formControlName="creditCard"
        placeholder="Enter 16-digit card number"
        maxlength="16"
      />
      <mat-error *ngIf="ticketForm.get('creditCard')?.hasError('required')">
        Credit card number is required
      </mat-error>
      <mat-error *ngIf="ticketForm.get('creditCard')?.hasError('pattern')">
        Credit card number must be 16 digits and numerical
      </mat-error>
    </mat-form-field>

    <div class="form-row">
      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Expiration Date (MM/YY)</mat-label>
        <input
          matInput
          type="text"
          id="expiration"
          formControlName="expiration"
          placeholder="MM/YY"
          required
        />
        <mat-error *ngIf="ticketForm.get('expiration')?.hasError('required')">
          Expiration date is required
        </mat-error>
        <mat-error *ngIf="ticketForm.get('expiration')?.hasError('pattern')">
          Expiration date must be in MM/YY format
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Security Code (CVV)</mat-label>
        <input
          matInput
          type="text"
          id="securityCode"
          formControlName="securityCode"
          required
          maxlength="3"
        />
        <mat-error *ngIf="ticketForm.get('securityCode')?.hasError('required')">
          Security code is required
        </mat-error>
        <mat-error *ngIf="ticketForm.get('securityCode')?.hasError('pattern')">
          Security code must be 3 digits and numerical
        </mat-error>
      </mat-form-field>
    </div>

    <h2 class="section-heading">Billing Address</h2>
    <mat-form-field appearance="fill">
      <mat-label>Street Address</mat-label>
      <input
        matInput
        type="text"
        id="address"
        formControlName="address"
        required
      />
      <mat-error *ngIf="ticketForm.get('address')?.hasError('required')">
        Address is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>City</mat-label>
      <input matInput type="text" id="city" formControlName="city" required />
      <mat-error *ngIf="ticketForm.get('city')?.hasError('required')">
        City is required
      </mat-error>
    </mat-form-field>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>Province</mat-label>
        <input
          matInput
          type="text"
          id="province"
          formControlName="province"
          required
        />
        <mat-error *ngIf="ticketForm.get('province')?.hasError('required')">
          Province is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Postal Code</mat-label>
        <input
          matInput
          type="text"
          id="postalCode"
          formControlName="postalCode"
          required
          placeholder="A1A 1A1"
        />
        <mat-error *ngIf="ticketForm.get('postalCode')?.hasError('required')">
          Postal code is required
        </mat-error>
        <mat-error *ngIf="ticketForm.get('postalCode')?.hasError('pattern')">
          Invalid postal code format (A1A 1A1)
        </mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="fill">
      <mat-label>Country</mat-label>
      <input
        matInput
        type="text"
        id="country"
        formControlName="country"
        required
      />
      <mat-error *ngIf="ticketForm.get('country')?.hasError('required')">
        Country is required
      </mat-error>
    </mat-form-field>

    <div class="form-actions">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="ticketForm.invalid || isSubmitting"
      >
        {{ isSubmitting ? "Processing Payment..." : "Complete Purchase" }}
      </button>
    </div>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  </form>
</div>
